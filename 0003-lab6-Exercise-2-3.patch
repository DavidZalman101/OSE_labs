From f44d7a258fa7f7b79acd3ebf73c5b0607d9f70c5 Mon Sep 17 00:00:00 2001
From: DavidZalman101 <davidzalman.101@gmail.com>
Date: Tue, 24 Jun 2025 22:35:15 +0300
Subject: [PATCH 03/12] lab6 - Exercise 2 + 3.

---
 kern/e1000.c | 12 ++++++++++++
 kern/e1000.h | 10 ++++++++++
 kern/pci.c   |  1 +
 3 files changed, 23 insertions(+)

diff --git a/kern/e1000.c b/kern/e1000.c
index 7570e75..476bdbf 100644
--- a/kern/e1000.c
+++ b/kern/e1000.c
@@ -1,3 +1,15 @@
 #include <kern/e1000.h>
 
 // LAB 6: Your driver code here
+
+/*
+	Gets called automatically when JOS finds the E1000 dev during boot.
+	Enables the device - allocate memory space/IO ports and interrupt lines.
+	Sets up driver initialization - prepares the device for use by JOS.
+*/
+int
+e1000_attach(struct pci_func *pcif)
+{
+	pci_func_enable(pcif);
+	return 0;
+}
diff --git a/kern/e1000.h b/kern/e1000.h
index e563ac4..0e47444 100644
--- a/kern/e1000.h
+++ b/kern/e1000.h
@@ -1,4 +1,14 @@
 #ifndef JOS_KERN_E1000_H
 #define JOS_KERN_E1000_H
 
+// Includes
+#include <kern/pci.h>
+
+// Defines
+#define E1000_VEN_ID 0x8086
+#define E1000_DEV_ID_82540EM 0x100E
+
+
+int e1000_attach(struct pci_func *);
+
 #endif	// JOS_KERN_E1000_H
diff --git a/kern/pci.c b/kern/pci.c
index 1b00be5..48e10dd 100644
--- a/kern/pci.c
+++ b/kern/pci.c
@@ -31,6 +31,7 @@ struct pci_driver pci_attach_class[] = {
 // pci_attach_vendor matches the vendor ID and device ID of a PCI device. key1
 // and key2 should be the vendor ID and device ID respectively
 struct pci_driver pci_attach_vendor[] = {
+	{E1000_VEN_ID, E1000_DEV_ID_82540EM, &e1000_attach},
 	{ 0, 0, 0 },
 };
 
-- 
1.9.1

